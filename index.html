<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Toivelista</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
    }
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    .item {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      transition: transform 0.2s;
      cursor: pointer;
    }
    .item:hover {
      transform: translateY(-5px);
    }
    .item img {
      width: 100%;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    .item h3 {
      margin: 0 0 10px 0;
      color: #2c3e50;
    }
    .item p {
      margin: 5px 0;
      color: #7f8c8d;
    }
    .status {
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 4px;
      display: inline-block;
      margin-bottom: 10px;
    }
    .saatavilla {
      background: #d4edda;
      color: #28a745;
    }
    .one-toive {
      background: #fff3cd;
      color: #ffc107;
    }
    .two-toivetta {
      background: #f8d7da;
      color: #dc3545;
    }
    .wishlist {
      font-size: 0.9em;
      margin-top: 10px;
    }
    .wishlist p {
      margin: 5px 0;
      font-style: italic;
    }
    header {
      background: #3498db;
      color: white;
      padding: 20px 0;
      text-align: center;
      margin-bottom: 30px;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      color: #7f8c8d;
      font-size: 0.9em;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      overflow-y: auto; /* Enable scrolling */
    }
    .modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh; /* Limit modal height */
      overflow-y: auto; /* Enable scrolling inside modal */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .modal-img {
      width: 100%;
      max-height: 500px; 
      object-fit: contain;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: #333;
    }
    .wish-form {
      margin-top: 20px;
    }
    .wish-form label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .wish-form input {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .wish-form button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    .wish-form button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <header>
    <h1>Toivelista</h1>
  </header>
  <div class="container">
    <div class="items-grid" id="items"></div>
  </div>
  <footer>
    <p>Viimeksi päivitetty: <span id="last-updated"></span></p>
  </footer>

  <!-- Modal for enlarged image and wish form -->
  <div id="itemModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <img id="modalImage" class="modal-img" alt="Esineen kuva">
      <h2 id="modalTitle"></h2>
      <p><strong>Sijainti:</strong> <span id="modalLocation"></span></p>
      <p><strong>Tila:</strong> <span id="modalStatus" class="status"></span></p>
      <div class="wish-form">
        <h3>Tee varaus</h3>
        <label for="wishName">Nimi:</label>
        <input type="text" id="wishName" placeholder="Syötä nimesi">
        <label for="wishOsasto">Osasto:</label>
        <input type="text" id="wishOsasto" placeholder="Syötä osastosi">
        <button onclick="openEmailClient()">Lähetä</button>
      </div>
    </div>
  </div>

  <script>
    // Liitä JSON-datasi tähän
    const items = {
      "items": [
       
        {
          "id": "004",
          "name": "Esittelyhylly",
          "image": "img/signal-2025-10-03-095436_004.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "005",
          "name": "Kaappi ruskealla ovella",
          "image": "img/signal-2025-10-03-095436_005.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "006",
          "name": "Kaappi kahdella ovella",
          "image": "img/signal-2025-10-03-095436_006.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
      /*   {
          "id": "007",
          "name": "Valkotaulu",
          "image": "img/signal-2025-10-03-095436_007.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, */
        {
          "id": "008",
          "name": "Matala hylly",
          "image": "img/signal-2025-10-03-095436_008.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
       
        {
          "id": "010",
          "name": "Lehtiteline",
          "image": "img/signal-2025-10-03-095436_010.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "011",
          "name": "Desinfiointipulloteline",
          "image": "img/signal-2025-10-03-095436_011.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "012",
          "name": "Esittelyteline",
          "image": "img/signal-2025-10-03-095436_012.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "013",
          "name": "Metallinen hylly",
          "image": "img/signal-2025-10-03-095436_013.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "014",
          "name": "Kaapisto",
          "image": "img/signal-2025-10-03-095436_014.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "015",
          "name": "Kori pyörillä",
          "image": "img/signal-2025-10-03-095436_015.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        {
          "id": "0017",
          "name": "Pöytä",
          "image": "img/signal-2025-10-03-095436_017.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
       
        {
          "id": "0019",
          "name": "CD-teline",
          "image": "img/signal-2025-10-03-095436_019.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "001",
          "name": "Nuuskamuikkuinen-tuoli",
          "image": "img/signal-2025-10-03-095436.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "1 toive",
          "wishlist": [
            {"organization": "Särkijärven koulu", "timestamp": "2025-11-05T12:00"}
          ]
        },
        {
          "id": "002",
          "name": "Niiskuneiti-tuoli",
          "image": "img/signal-2025-10-03-095436_002.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "1 toive",
          "wishlist": [
            {"organization": "Särkijärven koulu", "timestamp": "2025-11-05T12:00"}
          ]
        },
         {
          "id": "003",
          "name": "Muumipeikko-tuoli",
          "image": "img/signal-2025-10-03-095436_003.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "1 toive",
          "wishlist": [
            {"organization": "Särkijärven koulu", "timestamp": "2025-11-05T12:00"}
          ]
        }, 
        {
          "id": "020",
          "name": "Pöytä + tuoli",
          "image": "img/signal-2025-10-03-095436_020.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": [
          ]
        },
        {
          "id": "021",
          "name": "Ruskea kirjahylly",
          "image": "img/signal-2025-10-03-095436_021.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        
         {
          "id": "023",
          "name": "Kapea valkoinen kirjahylly",
          "image": "img/signal-2025-10-22-125615_002.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "024",
          "name": "Valkoinen kirjahylly",
          "image": "img/signal-2025-10-22-125615_003.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "025",
          "name": "Matala hylly",
          "image": "img/signal-2025-10-22-125615_004.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "026",
          "name": "Valkoinen kirjahylly",
          "image": "img/signal-2025-10-22-125615_005.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "027",
          "name": "Kapea valkoinen kirjahylly",
          "image": "img/signal-2025-10-22-125615_006.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        
         {
          "id": "029",
          "name": "Pyörivä mediahylly",
          "image": "img/signal-2025-10-22-125615_008.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        /* {
          "id": "030",
          "name": "Valkotaulu",
          "image": "img/signal-2025-10-22-125615_009.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, */
         {
          "id": "031",
          "name": "Ruskea vetolaatikosto",
          "image": "img/signal-2025-10-22-125615_010.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "032",
          "name": "Harmaa vetolaatikosto",
          "image": "img/signal-2025-10-22-125615_011.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         

         {
          "id": "034",
          "name": "Läpinäkyvä lehtiteline",
          "image": "img/signal-2025-10-22-125615_013.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        
         {
          "id": "036",
          "name": "Sininen tuoli",
          "image": "img/signal-2025-10-22-125615_015.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "037",
          "name": "Harmaa työtuoli",
          "image": "img/signal-2025-10-22-125615_016.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
        
         {
          "id": "039",
          "name": "Kapea valkoinen kirjahylly",
          "image": "img/signal-2025-10-22-125615_018.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "040",
          "name": "6kpl ruskeita jakkaroita",
          "image": "img/signal-2025-10-22-125615_019.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
         {
          "id": "041",
          "name": "Kahden levyn keittolevy",
          "image": "img/signal-2025-10-22-125615_020.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, {
          "id": "042",
          "name": "6kpl ruskeita tuoleja",
          "image": "img/signal-2025-10-22-125633.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },  {
          "id": "044",
          "name": "Esittelyteline",
          "image": "img/signal-2025-10-22-125633_003.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, {
          "id": "045",
          "name": "Läpinäkyvä lehtiteline",
          "image": "img/signal-2025-10-22-125633_004.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, {
          "id": "046",
          "name": "Kastelukannu",
          "image": "img/signal-2025-10-22-125633_005.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },{
          "id": "050",
          "name": "Pieni pöytä",
          "image": "img/signal-2025-10-22-125633_009.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, 
        /*  {
          "id": "052",
          "name": "",
          "image": "img/signal-2025-10-22-125633_011.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, {
          "id": "053",
          "name": "",
          "image": "img/signal-2025-10-22-125633_012.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },  */{
          "id": "055",
          "name": "6kpl CD-hylly",
          "image": "img/signal-2025-10-22-125633_014.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, {
          "id": "056",
          "name": "Palautuslaatikko",
          "image": "img/signal-2025-10-22-125633_015.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        }, {
          "id": "057",
          "name": "Jääkaappi",
          "image": "img/signal-2025-10-22-125633_016.jpeg",
          "location": "Monninkylän kirjasto",
          "status": "saatavilla",
          "wishlist": []
        },
      ]
    };

    // Määritä statuksen ja CSS-luokan välinen yhteys
    function getStatusClass(status) {
      switch (status) {
        case "saatavilla": return "saatavilla";
        case "1 toive": return "one-toive";
        case "2 toivetta": return "two-toivetta";
        default: return "";
      }
    }

    // Näytä esineet
   const container = document.getElementById('items');
items.items.forEach(item => {
  const itemDiv = document.createElement('div');
  itemDiv.className = `item`;
  const statusClass = getStatusClass(item.status);
  itemDiv.innerHTML = `
    <img src="${item.image}" alt="${item.name}">
    <h3>${item.name}</h3>
    <p><strong>Sijainti:</strong> ${item.location}</p>
    <p><strong>Tila:</strong> <span class="status ${statusClass}">${item.status}</span></p>
    <div class="wishlist">
      ${item.wishlist.length > 0 ? '<p><strong>Toiveet:</strong></p>' : ''}
      ${item.wishlist.map(w => {
        const date = new Date(w.timestamp);
        const options = {
          year: 'numeric',
          month: 'numeric',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        };
        return `<p>${w.organization} (${date.toLocaleString('fi-FI', options)})</p>`;
      }).join('')}
    </div>
  `;
  itemDiv.onclick = () => openModal(item);
  container.appendChild(itemDiv);
});


    // Modal functions
    const modal = document.getElementById("itemModal");
    const span = document.getElementsByClassName("close")[0];

    function openModal(item) {
      // Clear form fields when opening the modal
      document.getElementById("wishName").value = "";
      document.getElementById("wishOsasto").value = "";

      document.getElementById("modalImage").src = item.image;
      document.getElementById("modalTitle").textContent = item.name;
      document.getElementById("modalLocation").textContent = item.location;
      const statusSpan = document.getElementById("modalStatus");
      statusSpan.textContent = item.status;
      statusSpan.className = "status " + getStatusClass(item.status);
      modal.style.display = "block";
    }

       /* function openEmailClient() {
      const name = document.getElementById("wishName").value;
      const osasto = document.getElementById("wishOsasto").value;
      const itemName = document.getElementById("modalTitle").textContent;
        const currentItem = items.items.find(item => item.name === itemName);
      const itemId = currentItem.id;
  const itemImage = currentItem.image;

      // Pre-fill the email
      const subject = `Uusi toive: ${encodeURIComponent(itemName)}`;
const body = `Hei,%0D%0A%0D%0ATehyin toiveen esineestä:%0D%0A
    - ID: ${encodeURIComponent(itemId)}%0D%0A
    - Esine: ${encodeURIComponent(itemName)}%0D%0A
    - Kuvan nimi: ${encodeURIComponent(itemImage)}%0D%0A
    - Nimi: ${encodeURIComponent(name)}%0D%0A
    - Osasto: ${encodeURIComponent(osasto)}%0D%0A%0D%0A
    Terveisin,%0D%0A${encodeURIComponent(name)}`;
      // Open the default email client
      window.location.href = `mailto:kirjasto@askola.fi?subject=${subject}&body=${body}`;
    } */

function openEmailClient() {
  const name = document.getElementById("wishName").value;
  const osasto = document.getElementById("wishOsasto").value;
  const itemName = document.getElementById("modalTitle").textContent;
  const currentItem = items.items.find(item => item.name === itemName);
  const itemId = currentItem.id;
  const itemImage = currentItem.image;

  const subject = `New request: ${itemName}`;
  const body = `Hi,

I would like to request the following item:
- ID: ${itemId}
- Item: ${itemName}
- Image: ${itemImage}
- Name: ${name}
- Department: ${osasto}

Best regards,
${name}`;

  // Check if it's a mobile device
  if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
    if (window.plugins && window.plugins.emailComposer) {
      window.plugins.emailComposer.open({
        to: ['kirjasto@askola.fi'],
        subject: subject,
        body: body,
        isHtml: false
      });
    } else {
      // Fallback method
      window.location.href = `mailto:kirjasto@askola.fi?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }
  } else {
    // Desktop fallback
    window.location.href = `mailto:kirjasto@askola.fi?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  }
}

    // Clear form fields when closing the modal
    span.onclick = function() {
      document.getElementById("wishName").value = "";
      document.getElementById("wishOsasto").value = "";
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        document.getElementById("wishName").value = "";
        document.getElementById("wishOsasto").value = "";
        modal.style.display = "none";
      }
    }

    // Päivitä päivämäärä
    document.getElementById('last-updated').textContent = new Date().toLocaleDateString('fi-FI');
  </script>
</body>
</html>
